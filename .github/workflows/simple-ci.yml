name: ğŸš€ Simple CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  test:
    name: ğŸ§ª Run Tests
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ¦€ Setup Rust
      uses: actions-rs/toolchain@v1
      with:
        toolchain: stable
        profile: minimal
        override: true
        
    - name: ğŸŒ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        if [ -f package-lock.json ]; then
          npm ci
        else
          npm install
        fi
        
    - name: ğŸ§ª Run Rust unit tests
      run: cargo test --manifest-path programs/meteora-fee-router/Cargo.toml --verbose
      
    - name: âœ… Test completion
      run: echo "All tests completed successfully!"

  lint:
    name: ğŸ” Lint & Format
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ¦€ Setup Rust
      uses: actions-rs/toolchain@v1
      with:
        toolchain: stable
        profile: minimal
        override: true
        components: rustfmt, clippy
        
    - name: ğŸŒ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: ğŸ“¦ Install dependencies
      run: |
        if [ -f package-lock.json ]; then
          npm ci
        else
          npm install
        fi
        
    - name: ğŸ” Rust format check
      run: cargo fmt --all -- --check
      continue-on-error: true
      
    - name: ğŸ“ Rust clippy
      run: cargo clippy --all-targets --all-features -- -D warnings
      continue-on-error: true
      
    - name: âœ… Lint completion
      run: echo "Linting completed!"

  security:
    name: ğŸ”’ Security Audit
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ¦€ Setup Rust
      uses: actions-rs/toolchain@v1
      with:
        toolchain: stable
        profile: minimal
        override: true
        
    - name: ğŸ›¡ï¸ Basic security check
      run: |
        echo "Running basic security validation..."
        # Check for common security issues
        grep -r "unsafe" programs/ || echo "No unsafe code found âœ…"
        grep -r "unwrap()" programs/ || echo "No unwrap() calls found âœ…"
        echo "Security check completed!"
      continue-on-error: true